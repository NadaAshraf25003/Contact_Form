<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact_Form</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f8f9fa;
      margin: 20px;
      color: #333;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    h1,
    h3 {
      color: #00796b;
    }

    form {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      /* max-width: 00px; */
     width:50%;
      margin-bottom: 30px;
    }

    label {
      display: block;
      margin: 8px 0 4px;
      font-weight: bold;
    }

    input[type="text"],
    input[type="email"],
    select,
    input[type="search"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      box-sizing: border-box;
    }

    input[type="search"] {
      width: 50%;
      padding: 8px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      box-sizing: border-box;
    }

    input[type="checkbox"] {
      margin-right: 8px;
    }

    input[type="submit"],
    button {
      background-color: #00796b;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    input[type="submit"]:hover,
    button:hover {
      background-color: #004d40;
    }

    .table {
      overflow-x: auto;
      max-width: 100%;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      background-color: #fff;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.05);
    }

    th,
    td {
      padding: 12px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: #009688;
      color: white;
    }

    td i {
      cursor: pointer;
      color: #00796b;
      transition: color 0.2s;
    }

    td i:hover {
      color: #e53935;
    }

    tfoot {
      background-color: #f1f1f1;
      font-weight: bold;
      text-align: center;
    }

    #search_result {
      margin-top: 10px;
      color: #00796b;
      font-weight: bold;
    }

    .required {
      color: red;
    }
    .check{
        display: flex;
    }
     @media (max-width: 750px) {
       form {

     width:85%;
    }
      
    }
  </style>
  <body>
    <!-- Contact Form -->
    <hr />
    <form id="contact_form">
      <h1>Payment Form</h1>
      <p>Required fields are followed by <span class="required">*</span></p>
      <h3>Contact information</h3>
      <fieldset style="width: 50%">
        <legend>Title</legend>
        <div class="check">
            <input type="radio" id="mister" name="title" value="Mr." />
            <label for="mister">Mister</label> <br />
        </div>
        <div class="check">
            <input type="radio" id="miss" name="title" value="Ms." />
            <label for="miss">Miss</label>
        </div>
      </fieldset>
      <br />

      <label for="name">Name <span class="required">*</span></label>
      <input type="text" id="name" name="name" required /><br /><br />
      <label for="email">Email <span class="required">*</span></label>
      <input type="email" id="email" name="email" required /><br /><br />
      <label for="card">Card Type </label>
      <select name="card" id="card">
        <option value="visa">Visa</option>
        <option value="mastercard">MasterCard</option>
        <option value="americanexpress">American Express</option></select
      ><br /><br />
      <div class="check">
          <label for="save">Save data to use : </label>
          <input type="checkbox" id="save" /> <br /><br />
      </div>
      <input type="submit" value="Add User" /><br />
    </form>

    <!-- Localstorge -->
    <hr />
    <label for="search">Search : </label>
    <input type="search" id="search_input" />
    <button id="search_button">Search</button>
    <p id="search_result"></p>
    <h3>List of users</h3>
    <div class="table">
      <table border="1">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Card</th>
            <th>Save Data</th>
            <th>Edit</th>
            <th class="delete">Delete</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <!-- <tr>
            <td id="t_name"></td>
            <td id="t_email"></td>
            <td id="t_card"></td>
            <td><i class="fa-solid fa-download"></i></td>
            <td><i class="fa-solid fa-pen-to-square"></i></td>
            <td><i class="fa-solid fa-trash"></i></td>
          </tr> -->
        </tbody>
        <tfoot>
          <tr>
            <td colspan="6">
              <p>Number of Users <span class="num_users"></span></p>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
    <script>
      // Ex3:
      // localStorage.clear()
      // Localstorge
      var name_user = document.querySelector("#name");
      var email_user = document.querySelector("#email");
      var card_user = document.querySelector("#card");
      var num_users = document.querySelector(".num_users");
      var search_input = document.querySelector("#search_input").value;
      var search_button = document.querySelector("#search_button");
      var search_result = document.querySelector("#search_result");
      var contact_form = document.querySelector("#contact_form");

      // table
      var t_name = document.querySelector("#t_name");
      var t_email = document.querySelector("#t_email");
      var t_card = document.querySelector("#t_card");
      var tbody = document.querySelector("#tbody");
      var table = document.querySelector(".table");

      var index = localStorage.length;
      var ADD_USER = contact_form.addEventListener("submit", function (e) {
        e.preventDefault();
        index++;
        var user = {
          name: name_user.value,
          email: email_user.value,
          card: card_user.value,
          id: index,
        };
        localStorage.setItem(index, JSON.stringify(user));
        var user_arr = JSON.parse(localStorage.getItem(index));
        add_user(user_arr);

        tbody.innerHTML = "";
        loadAllUsers();
        contact_form.reset();
      });

      // to load all users from local storage and display them in the table
      function loadAllUsers() {
        if (localStorage.length == 0) {
          table.style.display = "none";
          console.log(0);
        } else {
          table.style.display = "block";
          num_users.innerHTML = localStorage.length;
          for (let i = 0; i < localStorage.length; i++) {
            var key = localStorage.key(i);
            var item = JSON.parse(localStorage.getItem(key));
            if (item && item.name && item.email) {
              add_user(item);
            }
          }
        }
      }
      loadAllUsers();

      // to create the row
      function add_user(user_arr) {
        tbody.innerHTML += `
    <tr data-id="${user_arr.id}">
            <td id="t_name">${user_arr.name}</td>
            <td id="t_email">${user_arr.email}</td>
            <td id="t_card">${user_arr.card}</td>
            <td><i class="fa-solid fa-download"></i></td>
            <td><i class="fa-solid fa-pen-to-square"></i></td>
            <td><i class="fa-solid fa-trash"></i></td>
          </tr>
    `;
      }

      // To delete && edit item
      tbody.addEventListener("click", function (e) {
        // Check if the clicked element is a delete icon
        if (e.target.classList.contains("fa-trash")) {
          // Get the row of the clicked icon
          var row = e.target.closest("tr");
          var userId = row.getAttribute("data-id");

          // Get the name from the first <td> (name column)
          var userName = row.cells[0].textContent;
          if (confirm(`Are you sure you want to delete user: ${userName}?`)) {
            row.remove();
            localStorage.removeItem(userId);
            console.log(userId);
          }
        }

        //   Check if the clicked element is a edit icon
        if (e.target.classList.contains("fa-pen-to-square")) {
          var row = e.target.closest("tr");
          var userId = row.getAttribute("data-id");
          var user = JSON.parse(localStorage.getItem(userId));

          // Fill form with user's data
          name_user.value = user.name;
          email_user.value = user.email;
          card_user.value = user.card;
          editId = userId; // set editing mode
          localStorage.removeItem(userId); // Call add user function to update user
          ADD_USER;
        }
      });

      // To search item
     search_button.addEventListener("click", function (e) {
  e.preventDefault();
  var item;
  var searchText = search_input.trim().toLowerCase(); // Get live input
  var found = false;

  for (let i = 0; i < localStorage.length; i++) {
    var key = localStorage.key(i);
    item = JSON.parse(localStorage.getItem(key));

    if (
      item &&
      (item.name.toLowerCase() === searchText ||
        item.email.toLowerCase() === searchText)
    ) {
      search_result.innerHTML = `✅ <strong>Found:</strong><br>User Name: ${item.name}<br>User Email: ${item.email}`;
      found = true;
      break;
    }
  }

  if (!found) {
    search_result.innerHTML = `❌ <strong>No match found.</strong>`;
  }
});

    </script>
  </body>
</html>
